{% extends "base.html" %}
{% block title %}Manage Rooms{% endblock %}

{% block content %}
<style>
    :root {
        --glass-bg: rgba(255, 255, 255, 0.95);
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    body { background-color: #f8f9fa; }

    .page-header {
        background: var(--primary-gradient);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .custom-card {
        background: var(--glass-bg);
        border: none;
        border-radius: 15px;
        transition: transform 0.3s ease;
    }

    .room-img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 12px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* Modern Table Styling */
    .table-container { border-radius: 15px; overflow: hidden; }
    .table thead { background-color: #f1f3f9; border-bottom: 2px solid #eef0f7; }
    .table th { font-weight: 600; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 0.5px; padding: 1.2rem; }
    .table td { vertical-align: middle; padding: 1.2rem; border-bottom: 1px solid #f1f3f9; }

    /* Custom Badges */
    .badge-soft-success { background: #e6fcf5; color: #0ca678; border: 1px solid #c3fae8; }
    .badge-soft-warning { background: #fff9db; color: #f08c00; border: 1px solid #fff3bf; }
    .badge-soft-danger { background: #fff5f5; color: #f03e3e; border: 1px solid #ffe3e3; }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .table thead { display: none; }
        .table td { display: block; text-align: right; border: none; position: relative; padding-left: 50%; }
        .table td::before {
            content: attr(data-label);
            position: absolute;
            left: 15px;
            width: 45%;
            text-align: left;
            font-weight: bold;
            color: #6c757d;
        }
        .table tr { display: block; border-bottom: 1px solid #eee; margin-bottom: 1rem; background: white; border-radius: 10px; }
        .room-img { width: 40px; height: 40px; }
    }
</style>

<div class="container">
    <div class="page-header shadow-sm">
    <div class="row align-items-center g-3">
        <div class="col-md-3">
            <h2 class="mb-1"><i class="bi bi-door-open-fill me-2"></i>Manage Rooms</h2>
            <p class="mb-0 opacity-75">Inventory Overview</p>
        </div>
        
        <div class="col-md-6">
            <form action="{{ url_for('manage_rooms') }}" method="GET" class="row g-2">
                <div class="col-md-4">
                    <input type="text" name="search_no" class="form-control rounded-pill border-0 shadow-sm" 
                           placeholder="Room No..." value="{{ request.args.get('search_no', '') }}">
                </div>
                
                <div class="col-md-5">
                    <select name="search_type" class="form-select rounded-pill border-0 shadow-sm">
                        <option value="" disabled selected>All Room Types</option>
                        <option value="single" {{ 'selected' if request.args.get('search_type') == 'single' }}>Single</option>
                        <option value="double" {{ 'selected' if request.args.get('search_type') == 'double' }}>Double</option>
                        <option value="deluxe" {{ 'selected' if request.args.get('search_type') == 'deluxe' }}>Deluxe</option>
                    </select>
                </div>

                <div class="col-md-3">
                    <div class="d-flex gap-2">
                        <button class="btn btn-light rounded-pill shadow-sm flex-grow-1" type="submit" title="Search">
                            <i class="bi bi-search text-primary"></i>
                        </button>
                        <a href="{{ url_for('manage_rooms') }}" class="btn btn-outline-light rounded-pill shadow-sm" title="Reset">
                            <i class="bi bi-arrow-counterclockwise"></i>
                        </a>
                    </div>
                </div>
            </form>
        </div>

        <div class="col-md-3 text-md-end">
            <a href="{{ url_for('add_room') }}" class="btn btn-light btn-lg rounded-pill shadow-sm">
                <i class="bi bi-plus-lg me-1"></i> Add Room
            </a>
        </div>
    </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card custom-card p-3 shadow-sm mb-3">
                <small class="text-muted">Total Rooms</small>
                <h4 class="fw-bold">{{ rooms|length }}</h4>
            </div>
        </div>
    </div>

    <div class="card custom-card shadow-sm border-0">
        <div class="table-responsive table-container">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Room Details</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in rooms %}
                    <tr>
                        <td data-label="ID" class="text-muted">#{{ r.id }}</td>
                        <td data-label="Room Details">
                            <div class="d-flex align-items-center">
                                <img src="{{ url_for('static', filename='uploads/' + r.photo) }}" class="room-img me-3">
                                <div>
                                    <div class="fw-bold text-dark">{{ r.room_no }}</div>
                                    <small class="text-muted">{{ r.room_type }}</small>
                                </div>
                            </div>
                        </td>
                        <td data-label="Price" class="fw-bold text-primary">${{ r.price }}</td>
                        <td data-label="Status">
                            <span class="badge rounded-pill 
                                {% if r.status == 'Available' %}badge-soft-success
                                {% elif r.status == 'Booked' %}badge-soft-warning
                                {% else %}badge-soft-danger{% endif %} px-3 py-2">
                                {{ r.status }}
                            </span>
                        </td>
                        <td data-label="Action">
                            <div class="d-flex gap-2 justify-content-sm-end justify-content-md-start">
                                <a href="{{ url_for('edit_room', id=r.id) }}" class="btn btn-sm btn-outline-warning rounded-circle">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <button type="button" class="btn btn-outline-danger rounded-circle btn-sm btn-delete" data-room-id="{{ r.id }}">
                                    <i class="bi bi-trash"></i>
                                </button>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center py-5 text-muted">
                            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                            No rooms found in the database.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% if total_pages > 1 %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination pagination-md justify-content-center">
            <li class="page-item {% if page == 1 %}disabled{% endif %}">
                <a class="page-link rounded-start-pill px-3" href="{{ url_for('manage_rooms', page=page-1) }}">Previous</a>
            </li>
            {% for p in range(1, total_pages+1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link px-3" href="{{ url_for('manage_rooms', page=p) }}">{{ p }}</a>
            </li>
            {% endfor %}
            <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                <a class="page-link rounded-end-pill px-3" href="{{ url_for('manage_rooms', page=page+1) }}">Next</a>
            </li>
        </ul>
    </nav>
    {% endif %}
</div>


<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteConfirmLabel">
          <i class="bi bi-exclamation-triangle-fill"></i> Confirm Delete
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this room?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form id="deleteForm" method="POST">
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function () {
  const deleteButtons = document.querySelectorAll('.btn-delete');
  const deleteForm = document.getElementById('deleteForm');
  const deleteModalEl = document.getElementById('deleteConfirmModal');
  const deleteModal = new bootstrap.Modal(deleteModalEl);

  deleteButtons.forEach(button => {
    button.addEventListener('click', () => {
      const roomId = button.getAttribute('data-room-id');
      deleteForm.action = `/delete_room_route/${roomId}`;
      deleteModal.show();
    });
  });
});
</script>

{% endblock %}