{% extends "base.html" %}
{% block title %}Manage Booking{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
        <div>
            <h2 class="fw-bold text-dark mb-1">
                <i class="bi bi-journal-bookmark-fill text-primary me-2"></i>Manage Bookings
            </h2>
            <p class="text-muted">View, search, and manage guest reservations.</p>
        </div>
        <div class="d-flex gap-2 flex-wrap">
            <a href="{{ url_for('booking_operations', mode='insert') }}" class="btn btn-primary shadow-sm">
                <i class="bi bi-plus-circle me-1"></i> New Booking
            </a>
            <!-- <button class="btn btn-outline-secondary shadow-sm bg-white">
                <i class="bi bi-printer me-1"></i> Export PDF
            </button> -->
            <a href="{{ url_for('export_bookings_pdf', q=query, field=field, start_date=start_date, end_date=end_date) }}" 
              class="btn btn-outline-secondary shadow-sm bg-white">
              <i class="bi bi-printer me-1"></i> Export PDF
            </a>
        </div>
    </div>

    <div class="container-fluid px-4 mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-dark m-0">Booking Directory</h3>
        <!-- <div class="badge bg-primary-subtle text-primary px-3 py-2 rounded-pill">
            {{ bookingdata|length }} Total Bookings
        </div> -->
    </div>

    <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="card-body p-4">
            <form method="get" class="row g-3">
                <div class="col-lg-3 col-md-6">
                    <div class="form-floating">
                        <select name="field" class="form-select border-0 bg-light">
                            <option value="first_name" {% if field=='first_name' %}selected{% endif %}>First Name</option>
                            <option value="room_no" {% if field=='room_no' %}selected{% endif %}>Room Number</option>
                            <option value="phone" {% if field=='phone' %}selected{% endif %}>Phone Number</option>
                        </select>
                        <label>Search Category</label>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="form-floating">
                        <input type="text" name="q" class="form-control border-0 bg-light" placeholder="Keyword" value="{{ query or '' }}">
                        <label>Keyword</label>
                    </div>
                </div>

                <div class="col-lg-2 col-md-6">
                    <div class="form-floating">
                        <input type="date" name="start_date" class="form-control border-0 bg-light" value="{{ start_date }}">
                        <label>Check-In From</label>
                    </div>
                </div>

                <div class="col-lg-2 col-md-6">
                    <div class="form-floating">
                        <input type="date" name="end_date" class="form-control border-0 bg-light" value="{{ end_date }}">
                        <label>Check-In To</label>
                    </div>
                </div>

                <div class="col-lg-2 col-md-12 d-flex align-items-center gap-2">
                    <button type="submit" class="btn btn-primary w-100 py-3 rounded-3 shadow-sm">
                        <i class="bi bi-search me-1"></i> Filter
                    </button>
                    <a href="{{ url_for('manage_booking') }}" class="btn btn-light py-3 border rounded-3">
                        <i class="bi bi-arrow-counterclockwise"></i>
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

    <div class="card border-0 shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4 text-muted small text-uppercase">ID</th>
                        <th class="text-muted small text-uppercase">Guest Detail</th>
                        <th class="text-muted small text-uppercase">Room</th>
                        <th class="text-muted small text-uppercase">Stay Dates</th>
                        <th class="text-muted small text-uppercase">Status</th>
                        <th class="text-muted small text-uppercase text-end pe-4">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for b in bookingdata %}
                    <tr>
                        <td class="ps-4 fw-bold text-muted">
                            <a href="{{ url_for('booking_operations', mode='select', id=b.book_id) }}" class="text-decoration-none fw-bold" title="select">
                                #{{ b.book_id }}
                            </a>
                        </td>
                        <td>
                            <div class="d-flex flex-column">
                                <span class="fw-bold text-dark">{{ b.first_name }} {{ b.last_name }}</span>
                                <span class="small text-muted"><i class="bi bi-telephone me-1"></i>{{ b.phone }}</span>
                            </div>
                        </td>
                        <td>
                            <span class="badge rounded-pill bg-info-subtle text-info border border-info-subtle px-3 py-2">
                                Room {{ b.room_no }}
                            </span>
                        </td>
                        <td>
                            <div class="small text-dark">
                                <div><i class="bi bi-calendar-check me-1 text-success"></i>{{ b.check_in_date }}</div>
                                <div><i class="bi bi-calendar-x me-1 text-danger"></i>{{ b.check_out_date }}</div>
                            </div>
                        </td>
                        <td>
                            {% if b.status == 'Booked' %}
                            <span class="badge bg-success-subtle text-success border border-success-subtle">Booked</span>
                            {% elif b.status == 'Cancel' %}
                            <span class="badge bg-danger-subtle text-danger border border-danger-subtle">Cancel</span>
                            {% elif b.status == 'Check out' %}
                            <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle">Checked Out</span>
                            {% else %}
                            <span class="badge bg-warning-subtle text-warning border border-warning-subtle">{{ b.status }}</span>
                            {% endif %}
                        </td>
                        <td class="text-end pe-4">
                            <div class="btn-group">
                                {% if b.status not in ['Check out','Cancel'] %}
                                <a href="{{ url_for('booking_operations', mode='update', id=b.book_id) }}" class="btn btn-sm btn-outline-primary" title="Edit">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                                {% endif %}
                                {% if b.status in ['Check out','Cancel'] %}
                                <a href="{{ url_for('booking_operations', mode='delete', id=b.book_id) }}" 
                                   class="btn btn-sm btn-outline-danger" 
                                   title="Delete">
                                    <i class="bi bi-trash"></i>
                                </a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-5">
                            <i class="bi bi-inbox fs-1 text-muted d-block mb-2"></i>
                            <span class="text-muted">No reservations found matching your criteria.</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% if total_pages > 1 %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item {{ 'disabled' if page <= 1 }}">
                <a class="page-link shadow-sm" href="{{ url_for('manage_booking', page=page-1, q=query, field=field) }}">Previous</a>
            </li>
            {% for p in range(1, total_pages+1) %}
            <li class="page-item {{ 'active' if p == page }}">
                <a class="page-link shadow-sm" href="{{ url_for('manage_booking', page=p, q=query, field=field) }}">{{ p }}</a>
            </li>
            {% endfor %}
            <li class="page-item {{ 'disabled' if page >= total_pages }}">
                <a class="page-link shadow-sm" href="{{ url_for('manage_booking', page=page+1, q=query, field=field) }}">Next</a>
            </li>
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}