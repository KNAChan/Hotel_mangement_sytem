{% extends "base.html" %}
{% block title %}Manage Booking{% endblock %}

{% block content %}
<div class="container mt-4">

<h3><i class="bi bi-journal-bookmark-fill"></i> Manage Bookings</h3>

<!-- ADD BOOKING -->
    <div class="d-flex justify-content-center align-items-center gap-3">

      <!-- Search Form -->
      <!-- <form method="get" class="d-flex align-items-center">
        <input type="text"
               name="q"
               value="{{query}}"
               class="form-control"
               placeholder="Search by guest name, phone, room no..."
               style="width: 250px;">
        <button class="btn btn-outline-primary ms-2">
          <i class="bi bi-search"></i> Search
        </button>
      </form> -->
      <form method="get" class="d-flex align-items-center gap-2">
  
        <!-- Combo box for search field -->
        <label class="form-label fw-bold">Search By</label>
        <select name="field" class="form-select" style="width: 180px;">
          <option value="first_name" {% if field=='first_name' %}selected{% endif %}>First Name</option>
          <option value="last_name" {% if field=='last_name' %}selected{% endif %}>Last Name</option>
          <option value="phone" {% if field=='phone' %}selected{% endif %}>Phone Number</option>
          <option value="room_no" {% if field=='room_no' %}selected{% endif %}>Room Number</option>
        </select>
      
        <!-- Search keyword input -->
        <input type="text"
                    name="q"
               class="form-control"
               placeholder="Enter keyword..."
               value="{{ query|default('') }}"
                    style="width: 250px;">
      
        <!-- Search button -->
        <button type="submit" class="btn btn-outline-primary">
          <i class="bi bi-search"></i> Search
        </button>
      
        <!-- Clear button -->
        <a href="{{ url_for('manage_booking') }}" class="btn btn-outline-secondary">
          <i class="bi bi-x-circle"></i> Clear
        </a>
      
      </form>


      <!-- Book Button -->
      <form method="post" enctype="multipart/form-data">
        <input type="hidden" name="mode" value="insert">
        <button class="btn btn-outline-primary ms-2">
          <!-- <a href="{{ url_for('booking_operations', mode='insert') }} "> -->
            <i class="bi bi-plus-circle"></i> New Booking
          <!-- </a> -->
        </button>
      </form>
    </div>

<!-- BOOKING LIST -->
<div class="card shadow-sm mt-3">
  <div class="card-header fw-bold">Booking List</div>
  <div class="card-body p-0">
    <table class="table table-hover mb-0">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Room Number</th>
          <th>Phone Number</th>
          <th>Email</th>
          <th>Check-In-Date</th>
          <th>Check-Out-Date</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for b in bookingdata %}
        <tr>
          <td>{{ b.book_id }}</td>
          <td>{{ b.first_name }}</td>
          <td>{{ b.last_name }}</td>
          <td>{{ b.room_no }}</td>
          <td>{{ b.phone }}</td>
          <td>{{ b.email }}</td>
          <td>{{ b.check_in_date }}</td>
          <td>{{ b.check_in_date }}</td>
          <td>
            <span class="badge bg-{{ 'success' if b.status=='Booked' else 'danger' }}">{{ b.status }}
            </span>
          </td>
          <td>
            <a href="{{ url_for('booking_operations',mode = 'delete', id=b.book_id) }}" class="btn btn-sm btn-danger" >
              <i class="bi bi-trash"></i>
            </a>
            {% if b.status != 'Check out' %}
            <a href="{{ url_for('booking_operations',mode = 'update', id=b.book_id) }}" class="btn btn-sm btn-warning">
              <i class="bi bi-pencil-square"></i>
            </a>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="9" class="text-center text-muted">
            No bookings found
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Pagination -->
    <nav aria-label="Page navigation" class="mt-3">
      <ul class="pagination justify-content-center">
        {% if page > 1 %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('manage_booking', page=page-1, q=query, field=field) }}">Previous</a>
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        {% for p in range(1, total_pages+1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('manage_booking', page=p, q=query, field=field) }}">{{ p }}</a>
        </li>
        {% endfor %}

        {% if page < total_pages %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('manage_booking', page=page+1, q=query, field=field) }}">Next</a>
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>

</div>
{% endblock %}
